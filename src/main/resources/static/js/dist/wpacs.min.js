/*!ipacs4.0 - 1.0.0-2021-01-20 */
function GetUrlParam(a){var b=document.location.toString(),c=b.split("?");if(c.length>1){for(var d,e=c[1].split("&"),f=0;f<e.length;f++)if(d=e[f].split("="),null!=d&&d[0]==a){var g=d[1];return"token"!=a&&"studyId"!=a||(g=window.atob(d[1])),g}return null}return null}const WPACS={};!function(a){WPACS.com=function(){function b(a){for(var b=document.cookie,c=b.split("; "),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return com.cookie(a,e[1],720),e[1]}return""}function c(a,b,c){var d=a+"="+b;if(c>0){var e=new Date;e.setTime(e.getTime+3600*c*1e3),d=d+"; expires="+e.toDateString()+";path=/;"}document.cookie=d}function d(){var a=h.split("//"),b=a[1].indexOf("/"),c=a[1].substring(b);return c.indexOf("?")!=-1&&(c=c.split("?")[0]),c}function e(b){var c=h.split("?");if(c.length>1){for(var d,e=c[1].split("&"),f=0;f<e.length;f++)if(d=e[f].split("="),null!=d&&d[0]==b){var g=d[1];return"token"!=b&&"studyId"!=b||(g=a.atob(d[1])),g}return null}return null}function f(){var a=h.split("?"),b=a[1];return b}function g(a){this.desc=a.desc,this.type=a.type||"get",this.url=eSetting.addrIni.serverIp+a.url,this.param=a.param||{},this.isShowLoader=a.isShowLoader||!1,this.dataType=a.dataType||"json",this.callBack=a.callBack,this.errorBack=a.errorBack,this.init()}this.cookie=function(a,d,e){return d?c(a,d,e):b(a)},this.delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1e4),document.cookie=a+"=;  expires=Thu, 01 Jan 1970 00:00:01 GMT;"};var h=document.location.toString();this.relativePath=function(){return h?d():null},this.param=function(a){return h?a?e(a):f():null},g.prototype={init:function(){this.sendRequest()},showLoader:function(){if(this.isShowLoader){var a='<div class="ajaxLoader"><div class="loader">加载中...</div></div>';$("body").append(a)}},hideLoader:function(){this.isShowLoader&&$(".ajaxLoader").remove()},sendRequest:function(){var a=this;$.ajax({type:this.type,url:this.url,data:this.param,dataType:this.dataType,async:!0,beforeSend:function(b){a.showLoader();var c=com.param("token");b.setRequestHeader("accessToken",c),b.setRequestHeader("Content-Type","application/json;charset=UTF-8")},success:function(b){a.hideLoader(),null!=b&&""!=b&&(200==b.status&&a.callBack?"[object Function]"===Object.prototype.toString.call(a.callBack)?a.callBack(b,a.desc):console.log(this.desc,"callBack is not a function"):a.errorBack?a.errorBack(this.desc,b):pop_up({title:a.desc+"提示",message:b.msg,yesName:"确定",noName:"取消"}))},error:function(b){console.log(a.desc+"error",b)}})}},this.AjaxRequest=g;$("body").data("studyId");this.studyId=function(a){return a?$("body").data("studyId").split(",")[0]:$("body").data("studyId")},this.study=function(a){new g({type:"get",url:"dicom/getByStudyId",desc:"获取检查",param:{studyId:com.studyId},isShowLoader:!0,dataType:"",callBack:a})},this.updateTag=function(a,b){new g({type:"POST",url:"tagsSet/updateTags",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",desc:"四角信息设置",callBack:b})},this.unlockImage=function(a,b){new g({type:"get",url:"dicom/unlockImage",desc:"解锁",param:{studyId:com.studyId},isShowLoader:!0,dataType:"",callBack:a,errorBack:b})},this.doFlag=function(a,b){new g({type:"POST",url:"dicom/doFlag",desc:"标记",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})},this.getByClassify=function(a,b){new g({type:"get",url:"windowSet/getByClassify",desc:"窗位窗宽设置",param:{classifyType:a},isShowLoader:!0,dataType:"",callBack:b})},this.delWindowSet=function(a){var b=$(".wwwc-item-check").attr("data-id");void 0!=b&&new g({type:"get",url:"windowSet/deleteWindowSet",desc:"窗位窗宽设置",param:{id:b},isShowLoader:!0,dataType:"",callBack:a})},this.addWindowSet=function(a,b){new g({type:"POST",url:"windowSet/addWindowSet",desc:"窗位窗宽设置",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})},this.updateWindowSet=function(a,b){new g({type:"POST",url:"windowSet/updateWindowSet",desc:"窗位窗宽设置",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})},this.detail=function(a){new g({type:"get",url:"dicom/getByStudyId",param:{opt:"detail",studyId:com.studyId},desc:"详情",isShowLoader:!0,dataType:"",callBack:a})},this.saveRecord=function(a,b){new g({type:"POST",url:"printRecord/saveRecord",desc:"打印",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})},this.getJpgPrint=function(a){new g({type:"GET",url:"print/getJpgPrint",desc:"获取排版",param:{studyIds:com.studyId},isShowLoader:!0,dataType:"json",callBack:a})},this.getPrinter=function(a){new g({type:"get",url:"printerSet/getPrinter",desc:"打印机设置",param:{},isShowLoader:!0,dataType:"",callBack:a})},this.addPrinter=function(a,b){new g({type:"POST",url:"printerSet/addPrinter",desc:"打印机设置",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})},this.updatePrinter=function(a,b){new g({type:"POST",url:"printerSet/updatePrinter",desc:"打印机设置",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})},this.delPrinter=function(a,b){new g({type:"get",url:"printerSet/deletePrinter",desc:"打印机设置",param:a,isShowLoader:!0,dataType:"json",callBack:b})},this.getTags=function(a){new g({type:"get",url:"tagsSet/getTags",desc:"四角信息设置",param:{},isShowLoader:!0,dataType:"json",callBack:a})},this.uploadJoinImage=function(a,b){new g({type:"POST",url:"dicom/uploadJoinImage",desc:"图像拼接",param:JSON.stringify(a),isShowLoader:!0,dataType:"json",callBack:b})}},WPACS.callbacks=function(){function a(a){var b=$(".printBoxSelect"),c="localPrinter",d=$("<option></option>").append(c);d.attr("data-id",0),d.attr("data-name",c),d.attr("data-printerType","local"),d.attr("data-ip","127.0.0.1"),d.attr("data-aet",c),d.attr("data-aetLocal",c),d.attr("data-port",c),d.attr("data-position",c),d.attr("data-type",c),d.attr("data-priority",c),d.attr("data-color",c),d.attr("data-magnifyType",c),a&&d.attr("selected",!0),b.append(d)}function b(){var a=$(".printBoxSelect option:selected"),b={id:a.attr("data-id"),name:a.attr("data-name"),printerType:a.attr("data-printerType"),ip:a.attr("data-ip"),aet:a.attr("data-aet"),aetLocal:a.attr("data-aetLocal"),port:a.attr("data-port"),position:a.attr("data-position"),type:a.attr("data-type"),priority:a.attr("data-priority"),color:a.attr("data-color"),magnifyType:a.attr("data-magnifyType")};return b}this.getPrinter=function(b){if(200==b.status){var c=$(".printBoxSelect");c.empty();var d=$(".printer-list-box").find(".leftBox"),e=d.find(".temp");e.empty();var f="printerName",g=com.cookie(f),h=!1,i=b.data;i.forEach(function(a){var b=$("<option></option>").append(a.name);b.attr("data-id",a.id),b.attr("data-name",a.name),b.attr("data-printerType",a.printerType),b.attr("data-ip",a.ip),b.attr("data-aet",a.aet),b.attr("data-aetLocal",a.aetLocal),b.attr("data-port",a.port),b.attr("data-position",a.position),b.attr("data-type",a.type),b.attr("data-priority",a.priority),b.attr("data-color",a.color),b.attr("data-magnifyType",a.magnifyType),g==a.name&&(h=!0,b.attr("selected",!0),"local"==a.printerType?($(".local-option").show(),$(".server-option").hide()):($(".server-option").show(),$(".local-option").hide())),c.append(b);var d=$('<li class="printer-inner" ></li>').append(a.name);d.attr("data-id",a.id),d.attr("data-name",a.name),d.attr("data-printerType",a.printerType),d.attr("data-ip",a.ip),d.attr("data-aet",a.aet),d.attr("data-aetLocal",a.aetLocal),d.attr("data-port",a.port),d.attr("data-position",a.position),d.attr("data-type",a.type),d.attr("data-priority",a.priority),d.attr("data-color",a.color),d.attr("data-magnifyType",a.magnifyType),e.append(d)}),d.append(e),a(!h)}else callbacks.errorTips(b.msg)},this.printerSet=function(){return b()},this.exeResult=function(a){200==a.status?console.log("操作成功！",a):callbacks.errorTips(a.msg)},this.wwwcShow=function(a){if(200==a.status){var b=$(".table2 tbody");b.empty(),$("#printSetwwwc").empty();var c=a.data;c.forEach(function(a,c){var d=$('<td class="name"></td>').append(a.name),e=$('<td class="wc"></td>').append(a.wc),f=$('<td class="ww"></td>').append(a.ww),g="";g=parseInt(c)<10?$('<td class="txt">Alt+'+parseInt(c)+"</td>"):$('<td class="txt"></td>');var h=$('<tr  data-id="'+a.id+'"></tr>');h.append(d,e,f,g),b.append(h),$("#printSetwwwc").append('<option data-ww="'+a.ww+'" data-wc="'+a.wc+'">'+a.name+"</option>")})}else callbacks.errorTips(a.msg)},this.reloadWwwc=function(a){if(200==a.status){var b=$(".device").val();com.getByClassify(b,callbacks.wwwcShow)}else callbacks.errorTips(a.msg)},this.errorTips=function(a){pop_up({title:"提示",message:"请求失败，"+a,yesName:"确定",noName:"取消"})}}}(window);